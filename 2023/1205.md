---
title: p7-æ­å»ºæ—¶çš„ç»†èŠ‚æ€»ç»“
mathjax: true
comments: false
---
<div class="post-info">
<span>cuzn</span>
|
<abbr title="2023-12-12T23:49:42.086277+08:00"><time datetime="2023-12-12T23:49:42.086277+08:00">2023-12-12 23:49:42</time></abbr>
|
<span>â­ï¸ 3</span>
|
<span>ğŸ’¬ï¸ 1</span>
<br>
<div><div class="post-tag">P7</div><div class="post-tag">åˆ†äº«</div></div>
</div>

<div id="reply-4843" class="reply reply-l0">
<div class="reply-header">
<span>cuzn</span>
</div>
<div class="reply-text">

# p7-è¯¾ä¸‹æ€»ç»“

ä»¥ä¸‹æ˜¯æˆ‘åœ¨å†™p7è¯¾ä¸‹æ—¶çœ‹æ•™ç¨‹ä¸åšå®¢äº§ç”Ÿçš„ä¸€äº›é—®é¢˜,è®°å½•ä¸€ä¸‹å®ƒä»¬çš„å›ç­”~

### **eretä¸æ”¯æŒå»¶è¿Ÿæ§½,è‹¥æ­£å¸¸æ“ä½œä¼šå¸¦æ¥ä»€ä¹ˆå½±å“?åº”å¦‚ä½•æ“ä½œä»¥é¿å…è¿™ç§å½±å“?**

![img1.png](/images/co-discussions/1205/img1.png)
å¦‚å›¾æ‰€ç¤º,

è®¾è®¡1:å½“eretæµåˆ°Dçº§æ—¶æ£€æµ‹eret,å¹¶æŠŠFçº§NPCæ”¹æˆEPC.

````verilog
NPC = (D_eret) ? EPC : else;
````

å¯¼è‡´çš„é—®é¢˜:ç›´æ¥ç±»æ¯”beqçš„è·³è½¬,eretçš„ä¸‹ä¸€æ¡æŒ‡ä»¤Aä¸å¯é¿å…åœ°ä¼šä»IMä¸­è¢«å–å‡ºæ¥,è€Œå®ƒæœ¬æ¥ä¸åº”è¯¥æµè¿›æ¥çš„.æ•…è¿™æ ·çš„è®¾è®¡ä¼šå¯¼è‡´**PCä¸€ä¸ªå‘¨æœŸçš„é”™è¯¯**.ä½†æ˜¯,ä¹‹å‰beqå¦‚æ­¤è®¾è®¡æ˜¯å› ä¸ºåªæœ‰æµåˆ°Dçº§åˆ©ç”¨Dçº§CMPæ¨¡å—æ¯”è¾ƒä¸¤ä¸ªæ•°,æ‰èƒ½å¾—åˆ°è·³è½¬ç»“æœ(å³NPC);è€Œ**eretçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„PCä¸€å®šæ˜¯EPC**.

æ‰€ä»¥æ”¹æˆè®¾è®¡2:å½“eretæµåˆ°Dçº§æ—¶æ£€æµ‹eret,è‹¥ä¸ºeretåˆ™**Fçº§PCç›´æ¥è¾“å‡ºä¸ºEPC**,å¦åˆ™ä»ä¸ºåŸæ¥çš„å€¼.NPCä»è€Œä¸º`PC + 4`

````
F_PC = (D_eret) ? EPC : F_PC_tmp;
F_NPC = (D_eret) ? EPC + 4;
````

ç›´è§‚çš„å›¾åƒè¡¨ç¤º:(æ¥è‡ªç­”ç–‘æ—¶ä¸€ä½åŒå­¦ç”»çš„å›¾)

![img2.png](/images/co-discussions/1205/img2.png)

### syscallçš„exccodeåœ¨å“ªä¸€çº§åˆ¤æ–­?

æ— æ‰€è°“.åœ¨æˆ‘çš„è®¾è®¡ä¸­,æˆ‘åœ¨Dçº§åˆ¤æ–­.

ä¸è¿‡å…¶å®åœ¨æ•™ç¨‹ä¸­`å¼‚å¸¸å¤„ç†æµçš„å®ç°`->`å¼‚å¸¸ç `è¿™ä¸€èŠ‚ä¸­,å¼‚å¸¸ç exccodeè¶Šå°çš„å¼‚å¸¸,ä¼˜å…ˆçº§è¶Šé«˜.

### åœ¨æœªå‡ºç°å¼‚å¸¸æ—¶,exccodeåº”è¯¥ç”¨å“ªä¸ªæ•°å­—è¡¨ç¤º?

æ•™ç¨‹ä¸­,ä¸­æ–­çš„exccodeä¸º0,ä½†æ˜¯ä¸­æ–­æ˜¯ä»å¤–éƒ¨è¾“å…¥çš„,ä¸å†…éƒ¨å¼‚å¸¸æ— å…³;è€Œexccodeæ˜¯ç”±å†…éƒ¨å¼‚å¸¸è¢«åˆ¤æ–­å‡ºæ¥çš„.æ•…**æŠŠæœªå‡ºç°å¼‚å¸¸çš„exccodeè®¾ç½®ä¸º0å³å¯**.
(ä¸è¦è®¾ç½®ä¸€äº›å¥‡æ€ªçš„æ•°,æ¯”å¦‚`5'd31`ä¹‹ç±»çš„()ä¸€æ˜¯å› ä¸ºä¸Šæœºå¯èƒ½å¢åŠ æ–°çš„å¼‚å¸¸exccode,äºŒæ˜¯å› ä¸ºè¿™æ ·æ¯ä¸€çº§åˆ¤æ–­exccodeçš„æ—¶å€™æŠŠå¼‚å¸¸exccodeå½“æˆ"éé›¶å€¼",è€Œé"é31å€¼"å¤„ç†,ä»è€Œå‡ºé”™)

### Fçº§ä¸­NPCæ¨¡å—å¯¹rst/req/stall/eretçš„å¤„ç†?

- **ä¼˜å…ˆçº§rst>req>stall>D_eret**
- ä¸ºä»€ä¹ˆreq>D_eret? å…¶å®è¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿ.reqçš„åŒæ—¶D_eret,æ„å‘³ç€å¼‚å¸¸å¤„ç†ç¨‹åºå‡ºç°äº†å¼‚å¸¸,è€Œè¿™æ˜¯å¾—åˆ°ä¿è¯ä¸ä¼šå‡ºç°çš„.
- ä¸ºä»€ä¹ˆstall>D_eret? å½“D_eretå’ŒstallåŒæ—¶å‘ç”Ÿ,å³Dçº§æ˜¯eret,E/Mçº§å­˜åœ¨`mtc0`æŒ‡ä»¤äº§ç”Ÿstallä¿¡å·,è¿™æ„å‘³ç€EPCè¿˜æ²¡æœ‰å‡†å¤‡å¥½,è¿˜éœ€è¦å†stallä¸€ä¼šå„¿.é‚£ä¹ˆå¿…é¡»è¦ä¼˜å…ˆå¤„ç†stall,å†å¤„ç†D_eret.
- ä»¥ä¸Šè®¨è®ºä¹Ÿå¯ä»¥ç†è§£ä¸º,D_eretåªæ˜¯æµæ°´çº§å†…éƒ¨çš„ä¸€ä¸ªå°æŒ‡ä»¤,è€Œreq/stalléƒ½æ›´ä¸ºå®è§‚,æ•…åº”å¤„ç†æ›´ä¸ºå®è§‚çš„ä¿¡å·.

### PC\bdåœ¨æµæ°´æ—¶å¯¹rst/req/stallçš„å¼‚å¸¸å¤„ç†?

(åŸºäºCP0è®¾ç½®åœ¨Mçº§)

- bdåœ¨Fçº§åˆ¤æ–­å,å‘åæµæ°´,ç›´è‡³æµåˆ°CP0æ¨¡å—ç”¨äºåˆ¤æ–­EPC

- `rst`æ¸…ç©º:`PC`å½’ä¸º`32'h0000_3000`,å…¶å®ƒä¿¡å·éƒ½ä¸º0

  `req`æ¸…ç©º:`PC`å½’ä¸º`32'h0000_4180`,å…¶å®ƒä¿¡å·éƒ½ä¸º0

  æ³¨æ„**ä»¥ä¸‹çš„ä¿¡å·ä¼˜å…ˆçº§**!!å¦åˆ™ä¸­æµ‹ä¼šå‡ºç°interrupt countçš„é—®é¢˜ï¼

- FDçº§:**ä¼˜å…ˆçº§:rst>req>stall**

  - `rst`:å…¨éƒ¨æµæ°´ä¿¡å·æŒ‰ç…§`rst`æ¸…ç©º;
  - `req`:éƒ¨åˆ†æµæ°´ä¿¡å·æŒ‰ç…§`req`æ¸…ç©º
  - `stall`:æ‰€æœ‰æµæ°´ä¿¡å·ä¿æŒä¸å˜.

- DEçº§:**ä¼˜å…ˆçº§rst>req>stall**

  - `rst`:å…¨éƒ¨æµæ°´ä¿¡å·æŒ‰ç…§`rst`æ¸…ç©º;
  - `req`:å…¨éƒ¨æµæ°´ä¿¡å·æŒ‰ç…§`req`æ¸…ç©º
  - `stall`:éƒ¨åˆ†æµæ°´ä¿¡å·æ¸…ç©º,`PC`,`bd`ç»§ç»­å‘ä¸‹ä¸€çº§æ­£å¸¸æµæ°´

- EMçº§:**ä¼˜å…ˆçº§rst>req**

  - `rst`:å…¨éƒ¨æµæ°´ä¿¡å·æŒ‰ç…§`rst`æ¸…ç©º
  - `req`:å…¨éƒ¨æµæ°´ä¿¡å·æŒ‰ç…§`req`æ¸…ç©º

- MWçº§:**ä¼˜å…ˆçº§rst>req**

  - `rst`:å…¨éƒ¨æµæ°´ä¿¡å·æŒ‰ç…§`rst`æ¸…ç©º
  - `req`:å…¨éƒ¨æµæ°´ä¿¡å·æŒ‰ç…§`req`æ¸…ç©º

### æ€ä¹ˆä¿è¯å¼‚å¸¸æŒ‡ä»¤ä¸ä¼šäº§ç”Ÿç»“æœ?

è¿™é‡Œçš„ç»“æœæŒ‡å‘å„ç§å¯„å­˜å™¨é‡Œå­˜è¿›å»äº†å€¼,åŒ…æ‹¬**GRF,DM,hi,lo**
ä¸€ç§æ¯”è¾ƒç²—æš´çš„å®ç°æ–¹æ³•:å‡å¦‚è¿™æ¡æŒ‡ä»¤æœ‰å¼‚å¸¸,é‚£ä¹ˆå°±æŠŠå®ƒè§†ä½œnopå‘åæµæ°´,å…·ä½“æ¥è¯´æ˜¯è¿™æ ·:

````verilog
E_instr = (E_exccode != 0) ? 0 : E_instr_tmp;//ä»¥Eçº§è¦ä»EMæµæ°´çº¿å¯„å­˜å™¨å‘Mçº§æµæ°´çš„E_insträ¸ºä¾‹å­
````

é€šè¿‡è¿™ç§æ–¹æ³•,å¤§å¤šæ•°å¼‚å¸¸æŒ‡ä»¤éƒ½å°†ä¸èƒ½å‘æŒ¥ä½œç”¨.ä½†æ˜¯å½“CP0æ”¾åœ¨Mçº§æ—¶,æœ‰å¯èƒ½äº§ç”Ÿä¸€ä¸ªå°bug,è§ä¸‹ä¸€ä¸ªé—®é¢˜

### CP0è®¾åœ¨Mçº§æ—¶,æ€ä¹ˆä¿è¯DMä¸ä¼šå­˜è¿›å¼‚å¸¸æŒ‡ä»¤è®©å®ƒå­˜çš„å€¼?

æœ‰ä¸¤ç§æ–¹æ³•.

- æ³•ä¸€:å°†å­˜æ•°/å–æ•°å¼‚å¸¸(`adel`/`ades`)ç½®äºEçº§åˆ¤æ–­.å³åœ¨ALUè¿ç®—å‡º`ALU_result`ä¹‹å,åˆ¤æ–­å…¶æ˜¯å¦æ˜¯è¿™ä¸¤ç§å¼‚å¸¸,å¾—åˆ°`E_exccode`.
  	ç”±ä¸Šä¸€ä¸ªé—®é¢˜çš„ä¾‹å­å¯çŸ¥,å› ä¸º`E_exccode`ä¸ä¸º0,æˆ‘ä»¬å°†ä»Eçº§å‡†å¤‡å‘Mçº§æµæ°´çš„`E_instr`æ¸…é›¶äº†,ä»è€ŒMçº§å¾—ä¸åˆ°å­˜æ•°/å–æ•°çš„ç›¸å…³	ä¿¡æ¯,	ä¸ä¼šå¯¹DMäº§ç”Ÿå½±å“.

- æ³•äºŒ:å°†å­˜æ•°/å–æ•°å¼‚å¸¸(`adel`/`ades`)ç½®äºMçº§åˆåˆ¤æ–­,å¾—åˆ°`M_exccode`æ¥å…¥CP0.è‹¥CP0æ˜¾ç¤ºäº§ç”Ÿå¼‚å¸¸(å³`req`ä¸º1),é‚£ä¹ˆå°†DMçš„å†™ä½¿èƒ½`byteen`ç½®0,ä»è€Œæ— æ³•å†™å…¥(è¿™é‡Œ**æ˜“é”™**,ä¸Šä¸€ä¸ªé—®é¢˜æåˆ°çš„"è§†ä¸ºnop"å¤„ç†æ–¹æ³•åœ¨è¿™ç§æ¶æ„ä¸­ä¼šå› ä¸º**å¤ªæ™šåˆ¤æ–­(å³åˆ°äº†CP0æ‰€åœ¨çº§æ‰åˆ¤æ–­)exccode**è€Œå¤±æ•ˆ,å¿…é¡»è¦æ”¹DMå†™ä½¿èƒ½)

  å…·ä½“æ¥è¯´:

  ````verilog
  assign m_data_byteen = (req) ? 4'b0 :
  					   m_data_byteen_tmp;
  ````

### ä¹˜é™¤æ§½MDUæ€ä¹ˆå¯¹ä¸­æ–­ä¿¡å·è¿›è¡Œååº”?

æ ¹æ®æ•™ç¨‹`P7æäº¤è¦æ±‚`->`ä¸­æ–­å¼‚å¸¸çº¦æŸ`ä¸­ä¸‹å›¾:

![img3.png](/images/co-discussions/1205/img3.png)

æˆ‘ä»¬åªéœ€è¦åœ¨mult/div/multu/divuç­‰ä¹˜é™¤æ³•ç›¸å…³æŒ‡ä»¤çš„**å¯åŠ¨ä¿¡å·**åˆ¤æ–­ä¸­åŠ å…¥`!req`,åœ¨mthi/mtloç­‰å†™hi/loç›¸å…³æŒ‡ä»¤çš„å†™ä½¿èƒ½ä¿¡å·ä¸­åŠ å…¥`!req`å³å¯.

</div>
<div class="reply-footer">
<abbr title="2023-12-12T23:49:42.091697+08:00"><time datetime="2023-12-12T23:49:42.091697+08:00">2023-12-12 23:49:42</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">â¤ï¸ 6</span>
</div>
</div>