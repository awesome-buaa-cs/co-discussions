---
title: 斐波那契数列challenge思路分享
layout: default
parent: 2024 年
nav_order: 1252
---
# 斐波那契数列challenge思路分享
<div class="post-info">
<span>赵骥远</span>
|
<abbr title="2024-08-27T15:43:40.006288+08:00"><time datetime="2024-08-27T15:43:40.006288+08:00">2024-08-27 15:43:40</time></abbr>
|
<span>⭐️ 3</span>
|
<span>💬️ 4</span>
<br>
<div><div class="post-tag">分享</div></div>
</div>

<div id="reply-4989" class="reply reply-l0">
<div class="reply-header">
<span>赵骥远</span>
</div>
<div class="reply-text">

# 斐波那契数列challenge![p1.png](/assets/cscore-image/23371524/019d64c7-5c23-41e0-b590-38feaa4e102b/p1.png)
## 题目分析
1. 相比于第一![p2.jpg](5)小问，本题的难点在于**输入位数从3位增加到了32位**，如果使用递推式，那O(n)的复杂度肯定不能再64周期内得到运算结果。
2. 根据题目提示，我们可以使用**矩阵快速幂**的优化方法来实现O(logn)的时间复杂度，从而最多在32个周期内即可得到运算结果（因为最多就输入32位）。
## 推导第n项表达式
![p2.png](/assets/cscore-image/23371524/68620458-4722-4bed-b4be-412cdd17d527/p2.png)**由数学归纳法可得出第n项的表达式**，而由于a1=a2=1，因此想要求出an，只需要求出[1,1;1,0]的n-2次幂矩阵即可，然后将其第一行两数相加即可得到an。  
## 矩阵快速幂
1. 所谓快速幂算法，其主要作用是把指数计算从O(n)的时间复杂度降低到O(logn)，从而大幅优化时间效率。
![p1.jpg](/assets/cscore-image/23371524/cdd51907-e0fd-4024-9a42-bd8dddb50c62/p1.jpg)
2. 该算法的要点有三个：**该位是否为1，该位位值是多少，ans现在是多少**。因此我们只需要在电路中记录这三个变量即可。同样的，也根据这三个变量来设计状态。
3. 由于该题目中底数是矩阵，因此在快速幂时只需要把2换成[1,1;1,0]矩阵即可，乘法为矩阵乘法。
## 设计状态
1. 本题中，我采用的状态是ans矩阵，用于记录当前周期中ans目前是多少（未计算本位输入）。由于是2*2矩阵，因此需要4个寄存器分别存放矩阵中的数据。
## 设计输入
1. 本题中，输入的值应该是当前周期所对应的位的值。例如第0周期对应指数第0位的值，第x周期对应指数第x位的值。
2. 在上升沿到来时，输入也应当改变成下一位的值。
3. 可以利用计数器和移位器实现获取输入的效果。周期+1，计数器+1，移位+1.
## 状态转移方程
1. 状态转移方程通过当前状态和输入，决定下一状态。在本题中，即通过当前ans和输入，决定下一周期的ans。因为第x周期对应指数第x位的值，而输入一共只有32位，因此在第32周期就可得出最终的ans值。
2. **在状态转移方程中，最重要的部分就是位值**。位值要对应当前的位数，所以要能够自动更新。自动更新的办法就是自己乘自己。其中位值的初始值就是[1,1;1,0]。（因为第0周期对应第0位，即[1,1;1,0]的1次幂）。
3. **如果当前输入是1，那么下一状态=当前状态*位值，否则下一状态=当前状态。**![p2.jpg](/assets/cscore-image/23371524/af6eba77-de11-48ae-a3db-9259f187415f/p2.jpg)
4. **初始化ans=[1,0;0,1]**

## 输出函数
### Moore状态机
1. Moore状态机的输出仅与当前状态有关，输出函数就是把ans的第一行相加即可。
2. 若选用Moore状态机，则需要在第32周期才能得到结果。（即遍历到第32位，当前ans为遍历过的0-31位的结果）。
### Mealy状态机
1. Mealy状态机的输出与当前状态和输入均有关。输出函数需要提前根据输入计算出下一状态，然后再将第一行相加得到结果。
2. 若选用Mealy状态机，则只需要在第31周期便能得到结果。
### 特殊注意
1. 当n>=3时可以用上述逻辑在最多32个周期后得到答案。
2. 当n=0，1，2时，需要对输出进行特殊判断。可以分别用比较器判断n>2,n=2,n=1,n=0,然后将四个比较器结果利用splitter分位器进行拼接，变成一个4位数，把这个四位数当作select值传入MUX中，并分别在输入1，2，4，8处传入对应的结果值，即可处理特殊情况。
## 反思感想
1. 由于计算过程会大量设计矩阵乘法，因此可以先封装一个矩阵乘法子电路。
2. 在做题过程中不断加深对有限状态机的理解，和对状态转移函数和输出函数的理解。明确状态的含义，每一步的意义，才能减少出错和debug的成本。
3. 注意本题矩阵指数是n-2，不是n。

</div>
<div class="reply-footer">
<abbr title="2024-08-27T15:43:40.03297+08:00"><time datetime="2024-08-27T15:43:40.03297+08:00">2024-08-27 15:43:40</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 2</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-4991" class="reply reply-l1">
<div class="reply-header">
<span>???</span>
</div>
<div class="reply-text">

???

</div>
<div class="reply-footer">
<abbr title="2024-08-27T17:32:46.305834+08:00"><time datetime="2024-08-27T17:32:46.305834+08:00">2024-08-27 17:32:46</time></abbr>
|
<span>???</span>
<span class="reply-vote">❤️ 1</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-4992" class="reply reply-l2">
<div class="reply-header">
<span>赵骥远 <a href="#reply-4991">回复</a> ???</span>
</div>
<div class="reply-text">

好的好的，谢谢助教，以补充

</div>
<div class="reply-footer">
<abbr title="2024-08-27T17:42:16.664311+08:00"><time datetime="2024-08-27T17:42:16.664311+08:00">2024-08-27 17:42:16</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5029" class="reply reply-l3">
<div class="reply-header">
<span>???</span>
</div>
<div class="reply-text">

???

</div>
<div class="reply-footer">
<abbr title="2024-08-30T17:10:54.045974+08:00"><time datetime="2024-08-30T17:10:54.045974+08:00">2024-08-30 17:10:54</time></abbr>
|
<span>???</span>
<span class="reply-vote">❤️ 5</span>
</div>
</div>