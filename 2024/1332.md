---
title: 补充一些MIPS的语言特性
layout: default
parent: 2024 年
nav_order: 1332
---
# 补充一些MIPS的语言特性
<div class="post-info">
<span>罗春宇</span>
|
<abbr title="2024-09-22T14:58:28.096985+08:00"><time datetime="2024-09-22T14:58:28.096985+08:00">2024-09-22 14:58:28</time></abbr>
|
<span>⭐️ 7</span>
|
<span>💬️ 3</span>
<br>
<div></div>
</div>

<div id="reply-5265" class="reply reply-l0">
<div class="reply-header">
<span>罗春宇</span>
</div>
<div class="reply-text">

最近校园网无法访问阿里云图床，如果图片没有正常显示，可以查看下面的pdf文件
- [pdf文件](https://bhpan.buaa.edu.cn/link/AA0FD560B81AD04DE29B83736FEFC2B9D7)
## 前言

在学习 MIPS 编程的过程中，你是否因为代码过于复杂而崩溃？本文将介绍一些课程网站上未提到的语言特性，帮助你大大降低 MIPS 编程的难度。

我们将探讨以下内容：

- 使用 `.eqv` 为寄存器取别名
- 利用宏封装 `print` 函数，实现重载，按需调用
- 使用宏封装 `for` 循环，支持多层嵌套
- 通过宏封装递归函数的调用过程

先来看一下代码的编写效果：

![代码效果](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221430771.png)

可以明显看出，代码的可读性和复用性都有了质的提升，调试的难度也随之降低。

运行效果如下：

![运行效果](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221435281.png)

除了中文无法正常显示外，`print` 函数和 `for` 循环都能正常运行。

## 使用 `.eqv` 为寄存器取别名

`.eqv` 指令除了用于定义常量，还可以为寄存器取别名，使代码更具可读性。

![使用 .eqv 为寄存器取别名](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221439038.png)

给寄存器取别名有以下优点：

- **提高可读性**：代码更易理解，方便他人和自己日后的阅读。
- **降低记忆负担**：不必记住繁杂的寄存器编号。
- **简化编程过程**：减少出错的可能性。

在代码中，只需用别名替代原本的寄存器：

![使用别名替代寄存器](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221442959.png)

对于贯穿整个程序的重要数据，建议为其分配寄存器别名，并在整个程序中长期使用。

## 使用宏封装 `print` 函数

宏具备以下特性，使其非常适合封装常用函数：

- **独立的段**：可以拥有自己的 `.data` 和 `.text` 段。
- **重载支持**：同名宏可以根据参数个数不同实现重载。

我们可以利用宏将打印字符串和数字的功能封装成一个 `print` 函数，方便调用。

封装代码如下：

![封装 print 函数](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221440360.png)

调用时，无论是打印数字还是字符串，都非常简洁：

![调用 print 函数](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221440235.png)

再也不需要在代码开头定义大量字符串，然后在使用时不断加载地址。

示例：

![调用示例](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221444915.png)

## 使用宏封装 `for` 循环

你可能会疑惑，`for` 循环也能封装吗？答案是肯定的。通过宏封装，不仅可以实现 **嵌套循环**，而且代码的可读性远超传统方法。

实现原理是将标签（label）作为参数传入宏中，从而实现循环的嵌套。

封装代码如下：

![封装 for 循环](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221445528.png)

调用方法：

- 外层循环的 `for` 和 `for_end` 放在外部。
- 内层循环的 `for` 和 `for_end` 放在内部。

示例代码：

![嵌套循环示例](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409221447377.png)

运行结果：

![运行结果](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409220956543.png)

可以看到，这种写法不仅执行正常，而且可以轻松实现多层嵌套，代码结构清晰明了。

## 使用宏封装函数调用

通过宏，我们还可以封装函数的传参和出入栈操作，使得函数调用更加优雅简洁。

封装代码如下：

![封装函数调用](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409220957708.png)

在程序中调用时，只需简单的一行代码：

![调用封装的函数](https://imgnorcx.oss-cn-shanghai.aliyuncs.com/img/202409220958425.png)

## 总结

通过为寄存器取别名，以及使用宏封装常用的 `for` 循环、`print` 函数和函数调用，我们可以显著提高代码的可读性，降低汇编语言编程的难度。

希望这些技巧能对你的 MIPS 编程之旅有所帮助！


</div>
<div class="reply-footer">
<abbr title="2024-09-22T14:58:28.104685+08:00"><time datetime="2024-09-22T14:58:28.104685+08:00">2024-09-22 14:58:28</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 14</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5266" class="reply reply-l0">
<div class="reply-header">
<span>???</span>
<div class="reply-verified">助教认证</div>
</div>
<div class="reply-text">

???

</div>
<div class="reply-footer">
<abbr title="2024-09-22T15:16:13.426212+08:00"><time datetime="2024-09-22T15:16:13.426212+08:00">2024-09-22 15:16:13</time></abbr>
|
<span>???</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5268" class="reply reply-l0">
<div class="reply-header">
<span>彭子峻</span>
</div>
<div class="reply-text">

这个方法的确能够大幅改善代码的可读性，精彩！

但以当前的实现，可能出现这一情况：若调用的循环变量在此前已被使用，且在循环后仍会被使用，那这样自然会导致将要使用的变量被循环改变，且没有复原，导致后续程序出现问题。

个人认为，针对这种可能，**我们不妨采取类似递归函数调用的处理方法**，在宏定义的开始先将要使用的变量存入栈内，待循环完成后再重新出栈。

这样写起来，应该比在优化后的循环语句前后，单独列出出入栈语句更加可读。

</div>
<div class="reply-footer">
<abbr title="2024-09-22T16:17:02.492656+08:00"><time datetime="2024-09-22T16:17:02.492656+08:00">2024-09-22 16:17:02</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 2</span>
</div>
</div>