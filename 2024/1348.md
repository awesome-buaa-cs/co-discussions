---
title: Logisim技巧、特性和错误自查
layout: default
parent: 2024 年
nav_order: 1348
---
# Logisim技巧、特性和错误自查
<div class="post-info">
<span>向滢澔</span>
|
<abbr title="2024-09-25T10:41:45.929466+08:00"><time datetime="2024-09-25T10:41:45.929466+08:00">2024-09-25 10:41:45</time></abbr>
|
<span>⭐️ 21</span>
|
<span>💬️ 9</span>
<br>
<div><div class="post-tag">分享</div><div class="post-tag">Logisim</div></div>
</div>

<div id="reply-5316" class="reply reply-l0">
<div class="reply-header">
<span>向滢澔</span>
</div>
<div class="reply-text">

# 🌟Logisim常用技巧合集（持续更新）✨
>  最近常有人问我一些logisim的基本操作，可惜最近本人忙的昏头烂额，有些问题没法及时解决，故整理一下logisim的技巧，以供自助查阅，及时解决大家的问题。

> **♥ 后续持续更新！♥**

## 同步复位寄存器
### 标准做法（推荐）
> ~~助教认证的内容~~

利用MUX的选择即可，由于寄存器本身就具有同步写入的功能，因此我们在输入的这一侧，利用MUX选择用于复位的0信号和正常的输入信号，复位信号接入到MUX的sel端口，由此实现了无论如何变动复位信号，只有当clk上升沿**且**复位为真的时候才复位，即同步复位。
![8f8c1db2d71c4129a782cc6e7642f2e5.png](/assets/cscore-image/22375354/2f10e022-d86c-4164-bd97-490bf7f08c90/8f8c1db2-d71c-4129-a782-cc6e7642f2e5.png)

### MUX换成与门
AND门也是一种“选择”，当与门一输入全1的时候，另一侧输出正常，而全0的时候，另一侧无法输出，相比MUX更灵活的是，你可以任意选择你需要复位**哪几位**，但是见仁见智吧。

![316edfebc64b423793fec7a88d479d6c.png](/assets/cscore-image/22375354/fce05570-1347-45f6-bb99-3e38acaa4f3d/316edfeb-c64b-4237-93fe-c7a88d479d6c.png)

### 利用寄存器的异步复位端口
本质上是用寄存器复位寄存器，但是每次给我说要同步复位寄存器的时候，我第一反应都是改造那个异步复位的端口，为了让这个口能够沿边缘触发，我考虑了加入一个边缘触发的元件，也就是一位寄存器，由于寄存器可以异步（立即）读出，因此这个一位寄存器就实现了隔离乱动的reset信号的功能，只有时钟上升沿才会输出一个上升沿当时的reset。

还有一点注意的是，这里reset需要对一位的寄存器复位，为的是下一次上升沿的时候，如果reset信号为低电平，必须保证我们存储数据的寄存器的复位端口也为低电平：
![ddd95d19c9c14c63973ace6e0ed3f2e8.png](/assets/cscore-image/22375354/e82f082f-3565-4c6b-8b02-f1296645f7cc/ddd95d19-c9c1-4c63-973a-ce6e0ed3f2e8.png)

## tunnel标签的自动化生成

我们分析logisim的circ文件发现，其实就是一个文本标记语言，那么我们就可以利用一些自动化程序写入，我在这里以P0——GRF这道题抛砖引玉一下，由于可能会需要很多label，但是一个个手输入过于麻烦，我们可以分析标签：
```xml
<comp lib="0" loc="(100,100)" name="Tunnel">
	<a name="facing" val="east"/>
	<a name="label" val="ttt0"/>
</comp>
```
经过试验，lib代表所在的组件库，其他的参数全是字面意思，那么我们只需要自动化修改`val`和`loc`即可，比如我用python生成32个标签便于后续使用：
```python
file_name = "./testlabel"
file_object = open(file_name, mode='w+', buffering=-1,encoding='UTF-8')

for i in range(0,32):
    file_object.write("<comp lib=\"0\" loc=\"({},100)\" name=\"Tunnel\">\n<a name=\"facing\" val=\"east\"/>\n<a name=\"label\" val=\"ttt{}\"/>\n</comp>\n".format(i*20+100,i))
```

我为了方便，省略了写入这一步骤，直接复制粘贴，后续我计划整理一个**完整的程序**分享一下，目前我们先看一下结果：

![c4964f27c5eb4d27880824172fd5f84a.png](/assets/cscore-image/22375354/2d343264-200f-4220-9a9a-02f2a6f10167/c4964f27-c5eb-4d27-8808-24172fd5f84a.png)

效果很好啊，这样就可以不需要每次都用键盘输入了，如果你能够计算出正确的位置，那还能节约更多时间。

> 善用tunnel，但是不要过度使用tunnel，太多的tunnel会让电路可读性下降很多的，debug也头疼……

## 给寄存器赋初始值
### MUX做法
这里分享一种常用的赋初值的方法，我们利用counter和MUX元件来实现。MUX两路分别是正常输入和初始值，其中初始值接0端口，MUX的选择端口接到counter的输出，counter的时钟接入电路统一的时钟即可。

这样，在第一个上升沿到达的时候，MUX仍处于0，所以寄存器写入了初值，并且counter被设置为1位，overflow的行为设置为锁定最大值，那么counter在第一个上升沿后锁定为1，使得MUX从正常输入给到寄存器，不影响后续行为，这样我们就优雅地实现了初始值的赋予：

![2566f7728e2748cbab55c48a3120d05e.png](/assets/cscore-image/22375354/0eabd20a-a072-4233-879a-ea5b9d4cd243/2566f772-8e27-48cb-ab55-c48a3120d05e.png)

其中counter设置为：

![f520722186c04b2a8e64c80a2327826d.png](/assets/cscore-image/22375354/a8866c03-0ddd-4848-91f3-c8a35a26c882/f5207221-86c0-4b2a-8e64-c80a2327826d.png)

（感谢助教）由于该方法会吃掉第一个输入的input，如果题目要求导致没有办法不忽略一次输入的时候，我们可以把MUX放在寄存器输出侧就可以解决：

![image.png](/assets/cscore-image/22375354/f0e85745-6a31-4791-8ca6-6a2f58cd8ddd/image.png)

以上两种方法可以根据题意选择合适的一种。

### 利用异或的更好做法
> 感谢张奕彤助教指导！

我们利用同一个数异或两次某数可以得到原数字的性质，在寄存器输入输出都异或上我们需要设置的初始值，这样正常的输入就不受影响；而寄存器初始一定为0x0，0异或任何数字都是那个数字本身，这里我们用默认输出的0x0异或我们的初值，这样就能够做到在第一个时钟上升沿来临之前就能够输出初始值，相比之前的做法更加具有普适性：

![6797cf959c294b7786edc9a0360a7b4c.png](/assets/cscore-image/22375354/a43a41d4-cfca-4154-b1a7-8e3ae749b8ff/6797cf95-9c29-4b77-86ed-c9a0360a7b4c.png)

## （特性）寄存器对于高阻态的响应
### 技巧
查阅logisim文档，文档里并未说明寄存器如何相应高阻态的输入的，不过根据逻辑，寄存器理应保持原状态。经过实验，的确如此：寄存器输入为高阻态的时候，时钟上升沿并不会使得寄存器被赋值。

![80c19db645854c5aa9b0b7d793009ba3.png](/assets/cscore-image/22375354/fe0d947e-6de4-47f0-9fa4-fb100a8ac098/80c19db6-4585-4c5a-a9b0-b7d793009ba3.png)

### 配合DMX
我们在建造GRF的时候可能会发现DMX原件有一个three-state的选项，其作用简而言之就是，如果你勾选了no，那么没有被选择的输出口将会输出全0（默认状态），而如果你勾选了yes，那么输出将变成高阻态，因此会使得除了你所选的寄存器之外，其他寄存器都会保持原有状态。这样就可以节约一个en端口的使用了。

> 但是毕竟文档里未说明这种情况，建议**谨慎使用**


## 记录simulation的状态
> 还在用大脑debug？你out啦！

在logisim的simulate菜单中，我们会发现一个叫做logging的二级窗口，这个便是记录电路经历状态用的工具，其中有selection、table、file三个子页面：

![1bc0aabef67f44008c17d4ad3f992ab3.png](/assets/cscore-image/22375354/a859fae8-bc0c-49d0-8228-4f584cc65bdb/1bc0aabe-f67f-4400-8c17-d4ad3f992ab3.png)

在selection页面我们选择信号，并add进入列表，之后我们在table里面便能看见表头变成了我们所选的器件，而这个界面你可以保持不关闭，比如你按ctrl+T来tick一次，这样变化的值就会被记录进表里面：

![892097334cd4446d946129ee051dcab5.png](/assets/cscore-image/22375354/0e49802d-f5a5-408d-a859-fc333c1ff15e/89209733-4cd4-446d-9461-29ee051dcab5.png)

由此debug再也不需要用脑子来记住之前做了什么，我们可以分析表的内容，节约时间。经助教确认，评测机也是通过logging这个功能实现评测的，因此出现的问题你也可以在本地复现。

## （特性）时钟信号

给人debug的时候发现一部分同学可能是出于对于logisim的不信任，所有的时钟他都只用一个输出，然后到处放tunnel。

实际上logisim里面的时钟是根据模拟的tick进行的，默认情况下都是高低电平各一个tick，因此所有参数相同的时钟都是同步的，你大可放心用好几个时钟在不同的地方，这样可以简化布线/用尽量少的tunnel，由此提高你的电路可读性。

## logisim控制台操作
>最近写评测机有感而发，觉得这些可能对于调试评测机有用，故记录在此。

你是否有疑虑为什么每次logisim评测机都是长得差不多，是否又疑虑half这个信号到底是干什么的，以下我们一一解答：

### logisim的tty模式
logisim在tty模式下可以不打开gui界面来调试你的电路，当你需要测试电路输出的时候你很可能会需要这个电路随时间的变化，此时你就可以输入：
```bash
$ java -jar logisim.jar 你的电路.circ -tty table
```
这样就可以在控制台中以最高速率模拟你的电路，并且打印出来**所有的输出端口**的值，以`\t`划分。

tty还有四五个其他参数，感兴趣的同学可以自行查看源代码。

### 复刻评测机
我们照着评测电路搭建一个自己的testbench电路，并且有一份正解（或者对拍的代码），作为module来load到该电路里面，此时比如如下：
![image.png](/assets/cscore-image/22375354/62bee011-267d-468b-9d13-014de4f1334f/image.png)

其中会发现，对拍的电路作为module被加载到左侧的最下面的文件夹里面了。

之后我们进入控制台输入(比如我们测试电路叫做testbench.circ)：
```bash
$ java -jar logisim.jar testbench.circ -sub 对拍电路.circ 你的电路。circ -tty table
```
这样就很方便的换成了你自己的电路接了进去并且开始模拟输出结果了，也可以用这个和其他电路互相对拍。

> 欸！我也有一道自制的小菜🤓☝
> 根据这里所述的原理，我修改了一下logisim并且和学长的魔改版MARS联动实现了一个P3专用评测机，[🌟点我查看](http://cscore.buaa.edu.cn/#/discussion_area/1425/1477/posts)。

## debug速查（持续更新）
- 外形
	- 和要求对应！
	- 以绿色点为基点，蓝色接口相对位置必须正确，其他装饰元素无所谓。
	- 接口顺序必须正确，仔细阅读评测电路里面的接口。
	- 因为外形导致漏接端口常常会在评测机里面显示高阻态**xxxx**
- 线路变红
	- 检查子电路的输出部分pin是否关闭设置为output
	- 检查tunnel是否重名导致多驱动等情况
- 线路变蓝
	- 检查线路连接的地方是否设置了enable three-state
	- 也有可能是logisim的bug，重启一下就好
	- 如果你需要让线变成绿色/深绿/黑色，并且保证没开three-state，那么你可以启动simulation后按Ctrl+R重置一下即可。
	- 检查你的输出pin是否设置为了output
- 其他
	- 一些线路在比较紧凑的元件上可能出现几个端口连在一起了，但是又被元件边缘把线遮住了看不见的情况，请务必小心连线。
	- 加法/乘法元件这种上下都有进位出入的元件请小心，不要贴的太紧，如果贴上了会被自动连线。这种bug还很难发现，因为小数字的时候没有进位，输出一切正常，到数字大了才开始出现bug。
	- 比较器有两种模式，分别为有符号和无符号的，如果涉及无符号数比较记得切换一下，因为默认不是无符号的。
- 输出问题
	- 评测输出结果为空？由于logging的特性，如果输出没有变化的话logging是不会记录任何的值的，因此会导致输出为空。
	- 输出为空还可能是时序问题，部分同学搭建FSM的时候可能会不小心延迟一整个周期才输出（比如错误地使用了多个寄存器）。
	- 输出为高阻态xxxx，考虑是否有地方未接入却被直接输出的情况即可，比如外观未对应，输出的MUX有地方没接，tunnel名字错误等等


</div>
<div class="reply-footer">
<abbr title="2024-09-25T10:41:45.935693+08:00"><time datetime="2024-09-25T10:41:45.935693+08:00">2024-09-25 10:41:45</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 22</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5327" class="reply reply-l1">
<div class="reply-header">
<span>向滢澔 <a href="#reply-5316">回复</a> 向滢澔</span>
</div>
<div class="reply-text">

2024/09/25 更新：一种异或赋初值方法

</div>
<div class="reply-footer">
<abbr title="2024-09-25T12:29:08.830076+08:00"><time datetime="2024-09-25T12:29:08.830076+08:00">2024-09-25 12:29:08</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5351" class="reply reply-l1">
<div class="reply-header">
<span>???</span>
<div class="reply-verified">助教认证</div>
</div>
<div class="reply-text">

???

</div>
<div class="reply-footer">
<abbr title="2024-09-25T19:55:29.476151+08:00"><time datetime="2024-09-25T19:55:29.476151+08:00">2024-09-25 19:55:29</time></abbr>
|
<span>???</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5354" class="reply reply-l2">
<div class="reply-header">
<span>向滢澔 <a href="#reply-5351">回复</a> ???</span>
</div>
<div class="reply-text">

明白了，但是第二种提供的方法可以有第一次输入，我待会修改一下，感谢助教！

</div>
<div class="reply-footer">
<abbr title="2024-09-25T20:28:28.12491+08:00"><time datetime="2024-09-25T20:28:28.12491+08:00">2024-09-25 20:28:28</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5585" class="reply reply-l1">
<div class="reply-header">
<span>向滢澔 <a href="#reply-5316">回复</a> 向滢澔</span>
</div>
<div class="reply-text">

2024/10/24更新：Logisim控制台操作

</div>
<div class="reply-footer">
<abbr title="2024-10-24T21:57:41.442027+08:00"><time datetime="2024-10-24T21:57:41.442027+08:00">2024-10-24 21:57:41</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5322" class="reply reply-l0">
<div class="reply-header">
<span>???</span>
</div>
<div class="reply-text">

???

</div>
<div class="reply-footer">
<abbr title="2024-09-25T11:24:31.103861+08:00"><time datetime="2024-09-25T11:24:31.103861+08:00">2024-09-25 11:24:31</time></abbr>
|
<span>???</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5326" class="reply reply-l1">
<div class="reply-header">
<span>向滢澔 <a href="#reply-5322">回复</a> ???</span>
</div>
<div class="reply-text">

收到，感谢指正，正在修改

</div>
<div class="reply-footer">
<abbr title="2024-09-25T12:17:09.985039+08:00"><time datetime="2024-09-25T12:17:09.985039+08:00">2024-09-25 12:17:09</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5369" class="reply reply-l0">
<div class="reply-header">
<span>罗春宇</span>
</div>
<div class="reply-text">

标签自动生成可以改成使用vim，上机的环境也可以用

</div>
<div class="reply-footer">
<abbr title="2024-09-26T10:10:53.180505+08:00"><time datetime="2024-09-26T10:10:53.180505+08:00">2024-09-26 10:10:53</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>
<hr class="reply-separator">
<div id="reply-5371" class="reply reply-l1">
<div class="reply-header">
<span>向滢澔 <a href="#reply-5369">回复</a> 罗春宇</span>
</div>
<div class="reply-text">

收到，晚些时候更新一下

</div>
<div class="reply-footer">
<abbr title="2024-09-26T11:16:48.406715+08:00"><time datetime="2024-09-26T11:16:48.406715+08:00">2024-09-26 11:16:48</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">❤️ 0</span>
</div>
</div>