---
title: ç¼–å†™verilogçš„ä¼˜ç§€å®è·µ/ç é£æ€»ç»“
layout: default
parent: 2024 å¹´
nav_order: 1509
---
# ç¼–å†™verilogçš„ä¼˜ç§€å®è·µ/ç é£æ€»ç»“
<div class="post-info">
<span>å‘æ»¢æ¾”</span>
|
<abbr title="2024-11-08T09:16:12.79555+08:00"><time datetime="2024-11-08T09:16:12.79555+08:00">2024-11-08 09:16:12</time></abbr>
|
<span>â­ï¸ 10</span>
|
<span>ğŸ’¬ï¸ 1</span>
<br>
<div><div class="post-tag">åˆ†äº«</div><div class="post-tag">Verilog</div></div>
</div>

<div id="reply-5856" class="reply reply-l0">
<div class="reply-header">
<span>å‘æ»¢æ¾”</span>
</div>
<div class="reply-text">

# å‰è¨€
> ğŸ¤“ğŸ‘†æœ€è¿‘ç»™å¥½æœ‹å‹debugçš„æ—¶å€™å‘ç°ä»–ä»£ç ç»å¸¸å‡ºç°è¯­æ³•æ€§å’Œwireæ¥é”™ä½ç½®é”™è¯¯ï¼Œè€Œä¸”å…¨å¾—é ç«çœ¼é‡‘ç›å»æ‰¾ï¼Œç‰¹åˆ«ç—›è‹¦ï¼Œä¸ºäº†é¿å…å¤§å®¶ä¹Ÿå‡ºç°verilogæŠ¥é”™ä¸€å¤§å †çš„æƒ…å†µï¼Œæ•…å†™ä¸‹æ­¤æ–‡ã€‚

è¿˜æœ‰ä¸€ç‚¹ï¼šå¦‚æœæœ‰å¥½æ„è§å¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘è¿˜ä¼šæ—¶ä¸æ—¶æ›´æ–°ä¸€ä¸‹è¿™é‡Œè¿™äº›å»ºè®®ã€‚

## 1. ç¼–å†™ä¹ æƒ¯

### 1-1. å®Œå–„è‰ç¨¿åç¼–å†™
å¯¹äºP4ä¹‹åçš„CPUæ¥è¯´ï¼Œè‰ç¨¿ç¡®å®æ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€ä»½ï¼Œä¸€ä¸ªä¼˜ç§€çš„è‰ç¨¿ä¸æ­¢å¯ä»¥è®©ä½ åœ¨å†™ä»£ç çš„æ—¶å€™æ›´åŠ é¡ºåˆ©ï¼Œåœ¨debugå’Œä¸Šæœºè€ƒè¯•çš„æ—¶å€™ä¹Ÿèƒ½è®©ä½ æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚

ä¸€ä»½å¥½çš„è‰ç¨¿ä¸ªäººè®¤ä¸ºé™¤äº†æ ‡è®°æ§åˆ¶ä¿¡å·ä¸è¿çº¿æ–¹æ³•çš„excelæ–‡æ¡£ï¼Œè¿˜åº”è¯¥æœ‰ä¸€ä»½è®¾è®¡çš„ç®€å›¾ï¼ŒåŒ…å«ä½ çš„cpuçš„å¤§æ¦‚çš„æ ·å­ï¼Œä»¥P5ä¸ºä¾‹ï¼Œæˆ‘æœ¬äººçš„è‰ç¨¿å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š
![IMG_2522.jpeg](/assets/cscore-image/22375354/704c97eb-8b89-4bb2-866f-7bcbf60fed94/IMG_2522.jpeg)

å½“ç„¶è‰ç¨¿çš„æ–¹å¼å¾ˆå¤šæ ·ï¼Œä½ å¤§å¯ä¸å¿…ç”»çš„è¿‡äºè¯¦ç»†ï¼Œè¿™é‡Œä¹Ÿæ¨èå‡ ç§è‰ç¨¿çš„æ–¹æ³•ï¼š
- æ§åˆ¶ä¿¡å·ä¸æ¥çº¿
	- åˆ©ç”¨excelæ„å»ºæ§åˆ¶ä¿¡å·çš„è¡¨
	- markdownçš„è¡¨æ ¼ä¹Ÿæ¯”è¾ƒæ¸…æ™°
	- çº¯æ‰‹å†™ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯ä¸Šæœºå¯èƒ½ä¼šæ¯”è¾ƒéš¾æ·»åŠ 
- CPUæ¶æ„è‰ç¨¿
	- logisimå…¶å®æ˜¯å¾ˆå¥½çš„è‰ç¨¿æœ¬ï¼Œåªå…³å¿ƒæ¨¡å—å¤–è§‚ï¼Œå†…éƒ¨å®ç°ç•™ç©ºå³å¯
	- draw.ioä¹Ÿæ˜¯ï¼Œåœ¨çº¿ç»˜å›¾
	- æˆ‘ç”¨è¿‡ä¸€ä¸ªå«axglyphçš„å›½äº§è½¯ä»¶ï¼Œä¹Ÿç®—å¥½ç”¨
	- çº¯æ‰‹ç»˜ï¼ˆprocreateã€æ— è¾¹è®°ã€psï¼‰ï¼Œä¸ªäººæ¯”è¾ƒå€¾å‘è¿™ä¸ªï¼Œè¿½æ±‚å®Œç¾çš„å¯ä»¥è€ƒè™‘

### 1-2. ä¸è¦è½»æ˜“å¼€å§‹ä»£ç 

å¯¹äºverilogè¿™ä¸ªè¡Œä¸ºçº§åˆ«çš„è¯­è¨€ï¼Œè™½ç„¶çœ‹èµ·æ¥å’Œcè¯­è¨€å·®ä¸å¤šï¼Œä½†æ˜¯è¦æ³¨æ„çš„å°±æ˜¯ä¸€å®šä¸èƒ½çº¯ç”¨cè¯­è¨€çš„æ€æƒ³æ¥è¿›è¡Œverilogè¯­è¨€çš„ç¼–å†™ï¼Œå¦‚æœè´¸ç„¶å¼€å§‹åªä¼šå¯¼è‡´ä½ é™·å…¥æ— å°½çš„ä»£ç é‡æ„ä¸debugçš„ç—›è‹¦æ·±æ¸Šã€‚

è‰ç¨¿æ‰“å®Œä¹‹åå¯ä»¥å†å¯¹ç…§ä½ å†™çš„æ§åˆ¶ä¿¡å·åˆ—è¡¨æ ¸å¯¹ä¸€æ¬¡ä¿¡æ¯æ˜¯ä¸æ˜¯æ­£ç¡®å¾€åæµè½¬ï¼Œè¿™ä¹Ÿæ˜¯æµæ°´çº¿æœ€éš¾debugçš„ä¸€ä¸ªåœ°æ–¹ã€‚

ä¸€å®šè¦æ³¨æ„ï¼š**åƒä¸‡ä¸è¦ä¸æ‰“è‰ç¨¿ç›´æ¥å¼€å†™**ï¼Œè¿™æ ·å¾ˆå®¹æ˜“å¯¼è‡´éš¾ä»¥å‘ç°çš„bugï¼Œå¯¼è‡´ä½ debugèŠ±è´¹æ›´å¤šç²¾åŠ›ï¼Œå¹²åˆ«çš„äº‹æƒ…çš„æ—¶å€™è¿˜åœ¨æƒ³`jal`ã€‚~~æ­¤å¤„å¿½ç•¥ä¸€æ¡6ç³»åœ£ç»~~

### 1-3. ä¸è¦è¿‡åº¦å‡†å¤‡è¯¾ä¸Š

æˆ‘æ›¾ç»ä¹ŸçŠ¯è¿‡è¿™ä¸ªé—®é¢˜ï¼Œåœ¨P4è¯¾ä¸‹é˜¶æ®µå‡ºäºå¯¹è‡ªå·±è®¾è®¡çš„ä¸è‡ªä¿¡ä»¥åŠå¯¹äºä¸Šæœºå†…å®¹çš„æœªçŸ¥ï¼Œæå‰è®¾è®¡äº†è¶…å‡ºè®¾è®¡èŒƒå›´çš„æ›´å¤šæŒ‡ä»¤ï¼Œè™½ç„¶çœ‹èµ·æ¥æ˜¯"å‡†å¤‡æ›´åŠ å……åˆ†"ï¼Œä½†æ˜¯æˆ‘å‘ç°ä¹Ÿäº§ç”Ÿäº†ä¸å°çš„é—®é¢˜ï¼š
- æ§åˆ¶ä¿¡å·å†²çª
- å®ç°å¤æ‚ï¼Œå¯èƒ½é€ æˆä¸åŒæŒ‡ä»¤çš„è€¦åˆ
- å¢æ·»çš„æŒ‡ä»¤å­˜åœ¨é”™è¯¯å½±å“å…¶ä»–æŒ‡ä»¤

æ€»ä¹‹ï¼Œå¯¹äºæäº¤çš„æœ€åä¸€ç‰ˆï¼Œæˆ‘å»ºè®®åªä¿ç•™ä¸Šæœºæ‰€éœ€çš„æœ€åŸºæœ¬æŒ‡ä»¤ï¼Œè¿™æ ·æ— è®ºæ˜¯å¯¹äºç°åœºdebugè¿˜æ˜¯å¢åŠ æŒ‡ä»¤éƒ½å¯ä»¥æ›´åŠ æ–¹ä¾¿ã€‚

### 1-4. è¿›è¡Œè¾ƒä¸ºå……åˆ†çš„æœ¬åœ°æµ‹è¯•

æœ‰ä¸€éƒ¨åˆ†äººï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±åœ¨å†…ï¼‰å¯¹äºéº»çƒ¦çš„æµ‹è¯•ååˆ†è‹¦æ¼ï¼Œäºæ˜¯å–œæ¬¢ç›´æ¥æäº¤åˆ°ojå¹³å°çœ‹æŠ¥ä»€ä¹ˆé”™è¯¯ï¼Œè™½ç„¶çœ‹èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œä½†æ˜¯å¹³å°åªä¼šå‘Šè¯‰ä½ ç¬¬ä¸€æ¬¡å‡ºé”™çš„åœ°æ–¹ï¼Œä½ ä¸ä¼šçŸ¥é“å‡ºé”™ä¹‹å‰ç»å†äº†ä»€ä¹ˆï¼Œä¾¿ä¼šå¯¼è‡´ä½ debugçš„æ—¶å€™è¿å“ªé‡Œå‡ºé—®é¢˜éƒ½ä¸çŸ¥é“ã€‚

è¿›è¡Œæœ¬åœ°æµ‹è¯•æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œå…¶ä¸€å°±æ˜¯æ‰‹åŠ¨ç¼–å†™MIPSç„¶åå¯¼å‡ºæœºå™¨ç ç»™verilogæ¥å¯¹æ¯”ï¼Œä½†æ˜¯æˆ‘æ›´å»ºè®®çš„æ˜¯åˆ©ç”¨åŒå­¦å‘å¸ƒçš„è‡ªåŠ¨è¯„æµ‹æœºæ¥è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œè¯„è®ºåŒºä¹Ÿæœ‰å¾ˆå¤šæ„é€ æ•°æ®çš„æ–¹æ³•ï¼Œéƒ½æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¤šçœ‹è¯„è®ºåŒºä¹Ÿæ˜¯å¾ˆå¥½çš„ä¹ æƒ¯ã€‚

## 2. ä»£ç é£æ ¼

### 2-1. æ¥å£å®šä¹‰

å»ºè®®åœ¨å¼€å¤´åŠ ä¸Šä¸€è¡Œå®šä¹‰ï¼š
```verilog
`default_nettype none
```

æ˜¾å¼æä¾›ä½ çš„æ¥å£æ˜¯`reg`è¿˜æ˜¯`wire`å…¶å®å¾ˆé‡è¦ï¼Œé»˜è®¤æ¥è¯´ä¸æä¾›ç±»å‹çš„æ¥å£éƒ½æ˜¯`wire`å‹ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´ä½ åœ¨å†…éƒ¨ç›´æ¥å¯¹è¾“å‡ºé”™è¯¯é©±åŠ¨çš„é—®é¢˜ï¼Œå¹¶ä¸”"ä¸æ˜¯å¾ˆèªæ˜"çš„ISEçš„è¯­æ³•æ£€æµ‹å™¨ä¹Ÿä¸ä¼šç»™ä½ æŠ¥é”™ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä½ çš„bugå°±éå¸¸çš„éš¾æ‰¾ã€‚

### 2-2. æ¨¡å—å†…å˜é‡å®šä¹‰ä½ç½®

ä¹‹å‰debugçš„æ—¶å€™å‘ç°èˆå‹çš„å˜é‡åˆ†æ•£å®šä¹‰åœ¨ä¸åŒåœ°æ–¹ï¼Œåå­—è¿˜å¯¹å¯¹é”™é”™çš„ï¼Œå¾ˆæ˜¯æ¼ç«ï¼Œå› æ­¤æˆ‘å»ºè®®å…¨éƒ¨æŒ‰ç…§ä½å®½æ•´ç†å¥½ï¼Œæ”¾åœ¨æ¨¡å—å†…éƒ¨æœ€ä¸Šæ–¹ï¼š
```verilog
module example(
// some interface
);
wire [31:0] a, b, c;
wire [4:0] a1, a2, a3;
reg reg_1, reg_2;
// specific code
endmodule
```
ç‰¹åˆ«æ˜¯å¯¹äºé¡¶å±‚æ¨¡å—çš„æ¥çº¿ï¼Œç”±äºååˆ†å¤æ‚ï¼Œä¸€å®šè¦å…»æˆè‰¯å¥½ä¹ æƒ¯ï¼Œä¸è¦ä¹±ä¸ƒå…«ç³Ÿæ”¾åœ¨å„ä¸ªåœ°æ–¹ã€‚

### 2-3. å˜é‡å‘½å

è¿™ä¸€ç‚¹è¯¾ç¨‹ç»„ä¹Ÿå¤šæ¬¡æåˆ°è¿‡ï¼Œé‡è¦æ€§æ›´æ˜¯ä¸è¨€è€Œå–»ï¼Œä¸€ä¸ªå¥½çš„å˜é‡å‘½ååº”è¯¥å°½é‡ä½¿ç”¨æœ‰æ„ä¹‰çš„å•è¯ï¼Œæˆ‘åœ¨è¿™é‡Œç»™ä¸€ä¸ªå‘½åçš„ä¾‹å­ï¼Œå½“ç„¶å…¶ä»–åå­—ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œæˆ‘åªæ˜¯æŠ›ç –å¼•ç‰ä¸€ä¸‹ï¼š

```verilog
wire modulename_jointname_level
// åˆ†åˆ«æ˜¯æ¨¡å—åå­—ï¼Œè¿æ¥æ¨¡å—çš„é‚£ä¸ªæ¥å£çš„åå­—ï¼Œæ‰€åœ¨æµæ°´çº¿çš„çº§åˆ«
```

å½“ç„¶å¤§å°å†™ä¹Ÿå¾ˆé‡è¦ï¼Œåˆ†æ¸…æ¥šå¤§å°å†™æ˜¯å¾ˆå¥½çš„ä¹ æƒ¯ï¼Œverilogæ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚

### 2-4. ç¼©çŸ­ä¸€è¡Œé•¿åº¦

åœ¨verilogé‡Œé¢è®¸å¤šè¯­å¥éƒ½ä¼šå¯¼è‡´è¶…çº§é•¿çš„ä¸€è¡Œï¼Œä½†æ˜¯åˆç”±äºverilogæ˜¯ç©ºç™½å­—ç¬¦ä¸æ•æ„Ÿçš„ï¼ˆåä¾‹ï¼špythonï¼‰ï¼Œæ˜¯åˆ©ç”¨åˆ†å·è¡¨ç¤ºä¸€ä¸ªè¯­å¥çš„ç»“æŸï¼Œå› æ­¤ä½ å¯ä»¥æ”¾å¿ƒå¤§èƒ†åœ°åœ¨ä¸€äº›åœ°æ–¹ç»™è¯­å¥åˆ†è¡Œï¼Œç‰¹åˆ«å»ºè®®åˆ†è¡Œçš„è¯­å¥åŒ…æ‹¬æ¨¡å—çš„ç¤ºä¾‹åŒ–ã€ä¸‰å…ƒè¿ç®—ç¬¦`?:`ï¼Œå¦‚ä¸‹ï¼š

```verilog
ALU alu_inst(	.A(rf_rd1_e),
				.B(rf_rd2_e),
				.C(alu_c_e),
				.ALUOp(ctrl_aluop_e));
// ...
assign data_in_d = (Op == 2'b00) ? data1 :
				   (Op == 2'b01) ? data2 :
				   (Op == 2'b10) ? data3 : data4;
// ...
```

### 2-5. ä¸è¦åœ¨ç¤ºä¾‹åŒ–æ¨¡å—çš„æ¥å£éƒ¨åˆ†ä½¿ç”¨ç³»ç»Ÿå‡½æ•°

è¿™ä¸ªå…¶å®ä¸ç®—ä¸€ä¸ªç é£å»ºè®®ï¼Œä½†æ˜¯ç”±äºISEçš„è¯­æ³•åˆ†æå™¨ç¡®å®æœ‰bugï¼Œå¯¼è‡´å¦‚ä¸‹è¯­å¥ä¼šè§¦å‘æŸä¸ªcppæ–‡ä»¶çš„fatal
errorï¼š

```verilog
ALU alu_inst(	.A(rf_rd1_e),
				.B($signed(rf_rd2_e)),
				.C(alu_c_e),
				.ALUOp(ctrl_aluop_e));
```

ç±»ä¼¼çš„è¿˜æœ‰`$display`,`$random`,`$time`ç­‰ç­‰ï¼Œä¸èƒ½åœ¨æ¥å£å¤„ä½¿ç”¨ï¼ˆå³ä½¿ç¬¦åˆverilogçš„è§„åˆ™ï¼‰ã€‚

## 3. å…¶ä»–å»ºè®®

### 3-1. ç¼–è¾‘å™¨çš„ä½¿ç”¨

ç”±äºISEå†…ç½®ç¼–è¾‘å™¨å®åœ¨æ˜¯ç»™äººä¸€ç§è¿‡äºå¤è€çš„æ„Ÿè§‰ï¼Œå»ºè®®é…åˆvscodeæ‰“å¼€é¡¹ç›®ç¼–è¾‘æ–‡ä»¶ï¼Œé…ç½®å¥½è¯­æ³•é«˜äº®å’Œè‡ªåŠ¨è¡¥å…¨ä¹‹åä½“éªŒä¼šå¾ˆå¥½ï¼Œå¹¶ä¸”vscodeä¿®æ”¹ä¿å­˜ä¹‹åå›åˆ°ISEéšä¾¿ç‚¹ä¸€ä¸‹å°±å¯ä»¥è§¦å‘æ–‡ä»¶çš„åˆ·æ–°ï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ã€‚

### 3-2. ç»ƒä¹ ä½¿ç”¨ISE

ç”±äºä¸Šæœºç¯å¢ƒæœ€ç¨³å®šçš„å…¶å®å°±æ˜¯ISEè¿™ä¸ªä¸å¤ªå¥½ä½¿çš„å·¥ç¨‹è½¯ä»¶ï¼Œå¯¹äºè¿™ç§è½¯ä»¶ä½ ç¡®å®å¯ä»¥å—¤ä¹‹ä»¥é¼»ï¼Œå› ä¸ºå®¢è§‚ä¸Šæ¥è¯´è¿™ç§å·¥ç¨‹è½¯ä»¶éƒ½æ˜¯"èƒ½è·‘å°±è¡Œ"ï¼Œå¯¹äºç”¨æˆ·ä½“éªŒæ˜¯æ ¹æœ¬ä¸ç®¡çš„ã€‚

ä½†æ˜¯ä½ å¾—ä¸Šæœºï¼Œä½ å°±å¾—ç†Ÿç»ƒæŒæ¡ISEçš„å„ç§æ“ä½œï¼Œæ¯”å¦‚ä½ å¾—åˆ†æ¸…å·¦ä¾§ä¸‹æ–¹çš„"è¯­æ³•æ£€æŸ¥"å’Œ"ç»¼åˆ"çš„åŒºåˆ«ï¼Œæœ‰äººç”¨äº†`initial`å—ä¹‹åé—®æˆ‘ä¸ºä»€ä¹ˆISEæŠ¥é”™ä¸ç»™"ä»¿çœŸ"ï¼Œæˆ‘ä¸€çœ‹å¥½å®¶ä¼™ï¼Œç‚¹çš„æ˜¯"synthesize"ï¼Œé‚£å½“ç„¶ä¸èƒ½"ç»¼åˆ"ï¼Œä½†æ˜¯ä½ åšä»¿çœŸå°±ä¸éœ€è¦ç®¡ç»¼åˆçš„äº‹æƒ…ï¼Œç›´æ¥å»testbenchæ–‡ä»¶é‚£é‡Œä»¿çœŸå°±è¡Œã€‚æˆ‘è§‰å¾—éœ€è¦ç†Ÿç»ƒæŒæ¡çš„æ“ä½œæœ‰ï¼š

- è¯­æ³•æ£€æµ‹
- å¯¼å…¥ä½ çš„cpuæ–‡ä»¶
- æœç´¢åŠŸèƒ½ï¼Œä¾¿äºdebug
- åˆ©ç”¨isimæ¨¡æ‹Ÿï¼Œæ·»åŠ è§‚æµ‹ä¿¡å·
- å³é”®ç‚¹å‡»æ‰§è¡Œé”™è¯¯çš„æ­¥éª¤å…¶å®å¯ä»¥rerunçš„

å…·ä½“ä¸å†èµ˜è¿°ï¼Œä½ å¯ä»¥ç™¾åº¦å¾—åˆ°ç»“æœã€‚

## åè®°

å¸Œæœ›å„ä½èƒ½å¤Ÿé¡ºåˆ©é€šè¿‡P3/P4/P5ä»¥åŠä¹‹åçš„æ¯ä¸ªä»»åŠ¡ï¼Œå¦‚æœä½ æš‚æ—¶å¡å…³äº†ï¼Œä¸è¦ç´§çš„ï¼Œä¸‹æ¬¡åŠªåŠ›é€šè¿‡å°±è¡Œï¼Œåˆ«çœ‹çš„å¤ªé‡äº†ã€‚

> ä¸€ç²’èŠéº»ï¼Œå‡‘è¿‘çœ‹ä¼šå æ®æ‰€æœ‰çš„è§†é‡ï¼›
>
> åŒå¤§å¤ªé˜³ï¼Œä¹Ÿä¸è¿‡æ˜¯å¤©ä¸Šçš„ä¸€ä¸ªç«çƒã€‚


</div>
<div class="reply-footer">
<abbr title="2024-11-08T09:16:12.825062+08:00"><time datetime="2024-11-08T09:16:12.825062+08:00">2024-11-08 09:16:12</time></abbr>
|
<span>CC BY-NC-SA 4.0</span>
<span class="reply-vote">â¤ï¸ 32</span>
</div>
</div>